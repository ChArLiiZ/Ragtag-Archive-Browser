# Archive Browser é–‹ç™¼è·¯ç·šåœ–

æœ¬æ–‡ä»¶è¨˜éŒ„å¾…å¯¦ä½œçš„åŠŸèƒ½éœ€æ±‚èˆ‡å¯¦ä½œæ–¹å‘ï¼Œæ–¹ä¾¿å¾ŒçºŒé–‹ç™¼åƒè€ƒã€‚

---

## å¾…å¯¦ä½œåŠŸèƒ½æ¸…å–®

| # | åŠŸèƒ½ | å„ªå…ˆç´š | ç‹€æ…‹ | é ä¼°è¤‡é›œåº¦ |
|---|------|--------|------|------------|
| 1 | é »é“åˆ—è¡¨é é¢ `/channels` | é«˜ | å¾…é–‹å§‹ | ä¸­ |
| 3 | 404 éŒ¯èª¤é é¢ | é«˜ | å¾…é–‹å§‹ | ä½ |
| 4 | é€²éšæœå°‹ç¯©é¸ | ä¸­ | å¾…é–‹å§‹ | ä¸­ |
| 5 | æ’­æ”¾æ¸…å–®æ’åºèˆ‡å¢å¼· | ä¸­ | å¾…é–‹å§‹ | ä¸­é«˜ |
| 7 | æœå°‹æ­·å²èˆ‡å»ºè­° | ä¸­ | å¾…é–‹å§‹ | ä¸­ |
| 8 | ç”¨æˆ¶é ­åƒè‡ªè¨‚ | ä¸­ | å¾…é–‹å§‹ | ä½ |
| 13 | æ•ˆèƒ½å„ªåŒ– | ä½ | å¾…é–‹å§‹ | ä¸­ |
| 14 | ä¸‹è¼‰åŠŸèƒ½ | ä½ | å¾…é–‹å§‹ | ä½ |

---

## 1. é »é“åˆ—è¡¨é é¢ `/channels`

### å•é¡Œæè¿°
Header å°èˆªä¸­æœ‰é€£çµåˆ° `/channels`ï¼Œä½†è©²é é¢ä¸å­˜åœ¨ï¼Œå°è‡´ 404 éŒ¯èª¤ã€‚

### éœ€æ±‚è¦æ ¼

**é é¢åŠŸèƒ½ï¼š**
- é¡¯ç¤ºæ‰€æœ‰å·²å­˜æª”çš„é »é“åˆ—è¡¨
- é »é“å¡ç‰‡é¡¯ç¤ºï¼šé ­åƒã€åç¨±ã€å½±ç‰‡æ•¸é‡ã€æœ€å¾Œæ›´æ–°æ™‚é–“
- æœå°‹é »é“åç¨±
- æ’åºé¸é …ï¼šå½±ç‰‡æ•¸é‡ã€æœ€å¾Œæ›´æ–°ã€åç¨±å­—æ¯é †åº
- åˆ†é æˆ–ç„¡é™æ»¾å‹•

**UI è¨­è¨ˆï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é »é“åˆ—è¡¨                        [æœå°‹æ¡†]       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  æ’åº: [å½±ç‰‡æ•¸é‡ â–¼] [å‡åº/é™åº]                 â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Avatar â”‚ â”‚  Avatar â”‚ â”‚  Avatar â”‚           â”‚
â”‚  â”‚ é »é“åç¨± â”‚ â”‚ é »é“åç¨± â”‚ â”‚ é »é“åç¨± â”‚           â”‚
â”‚  â”‚ 123 éƒ¨   â”‚ â”‚ 456 éƒ¨   â”‚ â”‚ 789 éƒ¨   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                 â”‚
â”‚  [1] [2] [3] ... [10]  åˆ†é                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¦ä½œæ­¥é©Ÿ

1. **API æ“´å±•** (`src/lib/api.ts`)
   ```typescript
   // æ–°å¢å‡½æ•¸
   interface ChannelInfo {
     channel_id: string;
     channel_name: string;
     video_count: number;
     last_updated: string;
   }

   // å–å¾—é »é“åˆ—è¡¨ - ä½¿ç”¨ aggregation æŸ¥è©¢
   export async function getChannels(options?: {
     query?: string;
     sort?: 'video_count' | 'last_updated' | 'name';
     sortOrder?: 'asc' | 'desc';
     from?: number;
     size?: number;
   }): Promise<{ channels: ChannelInfo[]; total: number }>
   ```

2. **å»ºç«‹é é¢** (`src/app/channels/page.tsx`)
   - ä½¿ç”¨ `useSearch` é¡ä¼¼çš„ hook æˆ–å»ºç«‹ `useChannels` hook
   - é »é“å¡ç‰‡å…ƒä»¶
   - æœå°‹èˆ‡æ’åºæ§åˆ¶

3. **å»ºç«‹å…ƒä»¶** (`src/components/channel/ChannelCard.tsx`)
   ```typescript
   interface ChannelCardProps {
     channelId: string;
     channelName: string;
     videoCount: number;
     lastUpdated?: string;
   }
   ```

### ç›¸é—œæª”æ¡ˆ
- `src/app/channels/page.tsx` (æ–°å»º)
- `src/components/channel/ChannelCard.tsx` (æ–°å»º)
- `src/lib/api.ts` (ä¿®æ”¹)
- `src/lib/types.ts` (ä¿®æ”¹)
- `src/components/layout/Header.tsx` (é©—è­‰é€£çµ)

### å‚™è¨»
- Ragtag Archive API å¯èƒ½éœ€è¦ aggregation æŸ¥è©¢ä¾†å–å¾—é »é“çµ±è¨ˆ
- å¦‚æœ API ä¸æ”¯æ´ï¼Œå¯ä»¥è€ƒæ…®ç”¨ Elasticsearch çš„ terms aggregation
- å‚™é¸æ–¹æ¡ˆï¼šå¾ç¾æœ‰å½±ç‰‡è³‡æ–™ä¸­èšåˆé »é“è³‡è¨Š

---

## 3. 404 éŒ¯èª¤é é¢

### å•é¡Œæè¿°
ç›®å‰å­˜å–ä¸å­˜åœ¨çš„è·¯å¾‘æ™‚æ²’æœ‰å‹å–„çš„éŒ¯èª¤é é¢ã€‚

### éœ€æ±‚è¦æ ¼

**é é¢åŠŸèƒ½ï¼š**
- é¡¯ç¤º 404 éŒ¯èª¤è¨Šæ¯
- æä¾›è¿”å›é¦–é çš„é€£çµ
- æä¾›æœå°‹æ¡†è®“ç”¨æˆ¶æœå°‹
- å¯é¸ï¼šé¡¯ç¤ºç†±é–€å½±ç‰‡æ¨è–¦

**UI è¨­è¨ˆï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚                    404                          â”‚
â”‚                                                 â”‚
â”‚            æ‰¾ä¸åˆ°æ‚¨è¦çš„é é¢                      â”‚
â”‚                                                 â”‚
â”‚     æ‚¨è¦æ‰¾çš„é é¢å¯èƒ½å·²è¢«ç§»é™¤æˆ–ç¶²å€æœ‰èª¤           â”‚
â”‚                                                 â”‚
â”‚          [ğŸ  è¿”å›é¦–é ]  [ğŸ” æœå°‹å½±ç‰‡]            â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                 â”‚
â”‚           ä¹Ÿè¨±æ‚¨æœƒå–œæ­¡é€™äº›å½±ç‰‡ï¼š                 â”‚
â”‚           (é¡¯ç¤ºå¹¾éƒ¨ç†±é–€å½±ç‰‡)                    â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¦ä½œæ­¥é©Ÿ

1. **å»ºç«‹ 404 é é¢** (`src/app/not-found.tsx`)
   ```typescript
   // Next.js 14 App Router ä½¿ç”¨ not-found.tsx
   export default function NotFound() {
     // ...
   }
   ```

2. **å¯é¸ï¼šå»ºç«‹é€šç”¨éŒ¯èª¤é é¢** (`src/app/error.tsx`)
   - è™•ç†å…¶ä»–åŸ·è¡Œæ™‚éŒ¯èª¤

### ç›¸é—œæª”æ¡ˆ
- `src/app/not-found.tsx` (æ–°å»º)
- `src/app/error.tsx` (å¯é¸ï¼Œæ–°å»º)

### å‚™è¨»
- Next.js App Router æœƒè‡ªå‹•ä½¿ç”¨ `not-found.tsx` è™•ç† 404
- å¯åŠ å…¥ Framer Motion å‹•ç•«å¢åŠ è¶£å‘³æ€§

---

## 4. é€²éšæœå°‹ç¯©é¸

### å•é¡Œæè¿°
ç›®å‰æœå°‹åªæ”¯æ´é—œéµå­—å’Œæ’åºï¼Œç¼ºå°‘é€²éšç¯©é¸åŠŸèƒ½ã€‚

### éœ€æ±‚è¦æ ¼

**ç¯©é¸é¸é …ï¼š**
- æ—¥æœŸç¯„åœï¼šä¸Šå‚³æ—¥æœŸ/å­˜æª”æ—¥æœŸ
- å½±ç‰‡é•·åº¦ï¼šçŸ­ç‰‡ (<5åˆ†é˜)ã€ä¸­ç­‰ (5-20åˆ†é˜)ã€é•·ç‰‡ (>20åˆ†é˜)ã€è‡ªè¨‚ç¯„åœ
- è§€çœ‹æ¬¡æ•¸ç¯„åœï¼šæœ€å°‘/æœ€å¤š
- æŒ‡å®šé »é“ï¼ˆå¯å¤šé¸ï¼‰

**UI è¨­è¨ˆï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [æœå°‹æ¡†................................] ğŸ”    â”‚
â”‚                                                 â”‚
â”‚  ç¯©é¸: [ğŸ“… æ—¥æœŸ] [â± é•·åº¦] [ğŸ‘ è§€çœ‹æ•¸] [ğŸ“º é »é“] â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€ æ—¥æœŸç¯©é¸ (å±•é–‹) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â—‹ ä¸é™                                    â”‚  â”‚
â”‚  â”‚ â—‹ æœ€è¿‘ä¸€é€±                                â”‚  â”‚
â”‚  â”‚ â—‹ æœ€è¿‘ä¸€å€‹æœˆ                              â”‚  â”‚
â”‚  â”‚ â—‹ æœ€è¿‘ä¸€å¹´                                â”‚  â”‚
â”‚  â”‚ â—‹ è‡ªè¨‚ç¯„åœ: [é–‹å§‹æ—¥æœŸ] ~ [çµæŸæ—¥æœŸ]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚
â”‚  å·²å¥—ç”¨ç¯©é¸: [é•·åº¦: 5-20åˆ†é˜ âœ•] [æ—¥æœŸ: æœ€è¿‘ä¸€é€± âœ•] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¦ä½œæ­¥é©Ÿ

1. **æ“´å±• SearchOptions é¡å‹** (`src/lib/types.ts`)
   ```typescript
   interface SearchFilters {
     dateRange?: {
       field: 'upload_date' | 'archived_timestamp';
       from?: string;  // ISO date
       to?: string;
     };
     duration?: {
       min?: number;  // seconds
       max?: number;
     };
     viewCount?: {
       min?: number;
       max?: number;
     };
     channelIds?: string[];
   }

   interface SearchOptions {
     // ... ç¾æœ‰æ¬„ä½
     filters?: SearchFilters;
   }
   ```

2. **ä¿®æ”¹ API** (`src/lib/api.ts`)
   - æ“´å±• `searchVideos` å‡½æ•¸æ”¯æ´ç¯©é¸åƒæ•¸
   - æ§‹å»º Elasticsearch range query

3. **å»ºç«‹ç¯©é¸å…ƒä»¶** (`src/components/search/SearchFilters.tsx`)
   - æ—¥æœŸé¸æ“‡å™¨
   - é•·åº¦ç¯„åœæ»‘æ¡¿æˆ–é è¨­é¸é …
   - è§€çœ‹æ¬¡æ•¸è¼¸å…¥
   - é »é“å¤šé¸å™¨

4. **ä¿®æ”¹æœå°‹é é¢** (`src/app/search/page.tsx`)
   - æ•´åˆç¯©é¸å…ƒä»¶
   - URL åƒæ•¸åŒæ­¥ (ç¯©é¸æ¢ä»¶æ‡‰åæ˜ åœ¨ URL)

5. **æ“´å±• useSearch hook** (`src/hooks/useSearch.ts`)
   - æ–°å¢ç¯©é¸ç‹€æ…‹ç®¡ç†
   - ç¯©é¸è®Šæ›´æ™‚é‡æ–°æœå°‹

### ç›¸é—œæª”æ¡ˆ
- `src/lib/types.ts` (ä¿®æ”¹)
- `src/lib/api.ts` (ä¿®æ”¹)
- `src/hooks/useSearch.ts` (ä¿®æ”¹)
- `src/app/search/page.tsx` (ä¿®æ”¹)
- `src/components/search/SearchFilters.tsx` (æ–°å»º)
- `src/components/ui/date-picker.tsx` (å¯èƒ½éœ€è¦æ–°å»º)
- `src/components/ui/slider.tsx` (å¯èƒ½éœ€è¦æ–°å»º)

### å‚™è¨»
- éœ€ç¢ºèª Ragtag Archive API æ”¯æ´çš„æŸ¥è©¢åƒæ•¸
- ç¯©é¸æ¢ä»¶æ‡‰å­˜å…¥ URL ä»¥ä¾¿åˆ†äº«
- è€ƒæ…®ä½¿ç”¨ Popover æˆ–å´é‚Šæ¬„é¡¯ç¤ºç¯©é¸é¸é …

---

## 5. æ’­æ”¾æ¸…å–®æ’åºèˆ‡å¢å¼·

### å•é¡Œæè¿°
æ’­æ”¾æ¸…å–®åŠŸèƒ½å·²å¯¦ä½œåŸºæœ¬çš„æ–°å¢/åˆªé™¤ï¼Œä½†ç¼ºå°‘æ’åºå’Œé€²éšç®¡ç†åŠŸèƒ½ã€‚

### éœ€æ±‚è¦æ ¼

**æ–°åŠŸèƒ½ï¼š**
- æ‹–æ›³é‡æ–°æ’åºæ’­æ”¾æ¸…å–®é …ç›®
- ç·¨è¼¯æ’­æ”¾æ¸…å–®æè¿°
- æ‰¹æ¬¡æ–°å¢å½±ç‰‡åˆ°æ’­æ”¾æ¸…å–®
- å¾ªç’°æ’­æ”¾æ¨¡å¼ï¼ˆå–®æ›²å¾ªç’°ã€æ¸…å–®å¾ªç’°ã€ä¸å¾ªç’°ï¼‰
- æ’­æ”¾æ¸…å–®åŒ¯å‡º/åˆ†äº«

**UI è¨­è¨ˆï¼ˆæ’­æ”¾æ¸…å–®è©³æƒ…é ï¼‰ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æˆ‘çš„æ’­æ”¾æ¸…å–®åç¨±                    [ç·¨è¼¯] [â‹®] â”‚
â”‚  é€™æ˜¯æ’­æ”¾æ¸…å–®çš„æè¿°æ–‡å­—...                      â”‚
â”‚  12 éƒ¨å½±ç‰‡ Â· å»ºç«‹æ–¼ 2024/01/15                  â”‚
â”‚                                                 â”‚
â”‚  [â–¶ å…¨éƒ¨æ’­æ”¾] [ğŸ”€ éš¨æ©Ÿæ’­æ”¾] [ğŸ” å¾ªç’°: é—œé–‰ â–¼]   â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â‹®â‹® 1. å½±ç‰‡æ¨™é¡Œ                    [âœ•]    â”‚  â”‚
â”‚  â”‚ â‹®â‹® 2. å½±ç‰‡æ¨™é¡Œ                    [âœ•]    â”‚  â”‚
â”‚  â”‚ â‹®â‹® 3. å½±ç‰‡æ¨™é¡Œ                    [âœ•]    â”‚  â”‚
â”‚  â”‚     (æ‹–æ›³ â‹®â‹® å¯é‡æ–°æ’åº)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¦ä½œæ­¥é©Ÿ

1. **å®‰è£æ‹–æ›³å¥—ä»¶**
   ```bash
   npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
   ```

2. **æ“´å±• Supabase å‡½æ•¸** (`src/lib/supabase.ts`)
   ```typescript
   // æ›´æ–°æ’­æ”¾æ¸…å–®é …ç›®é †åº
   export async function reorderPlaylistItems(
     playlistId: string,
     itemIds: string[]  // æ–°é †åºçš„ item IDs
   ): Promise<void>

   // æ‰¹æ¬¡æ–°å¢åˆ°æ’­æ”¾æ¸…å–®
   export async function addMultipleToPlaylist(
     playlistId: string,
     videos: Array<{
       videoId: string;
       title: string;
       channelName: string;
       thumbnailUrl: string;
     }>
   ): Promise<void>
   ```

3. **å»ºç«‹å¯æ‹–æ›³æ¸…å–®å…ƒä»¶** (`src/components/playlist/SortablePlaylistItems.tsx`)
   - ä½¿ç”¨ @dnd-kit å¯¦ä½œæ‹–æ›³æ’åº
   - æ‹–æ›³æ™‚é¡¯ç¤ºè¦–è¦ºæç¤º
   - æ‹–æ›³å®Œæˆå¾Œå‘¼å« API æ›´æ–°é †åº

4. **ä¿®æ”¹æ’­æ”¾æ¸…å–®è©³æƒ…é ** (`src/app/playlists/[id]/page.tsx`)
   - æ•´åˆæ‹–æ›³æ’åº
   - æ–°å¢ç·¨è¼¯æè¿°åŠŸèƒ½
   - æ–°å¢å¾ªç’°æ’­æ”¾é¸é …

5. **ä¿®æ”¹è§€çœ‹é é¢** (`src/app/watch/[id]/page.tsx`)
   - æ”¯æ´å¾ªç’°æ’­æ”¾æ¨¡å¼
   - æ’­æ”¾å®Œç•¢æ™‚æ ¹æ“šæ¨¡å¼æ±ºå®šä¸‹ä¸€æ­¥

6. **å»ºç«‹æ‰¹æ¬¡é¸æ“‡å…ƒä»¶** (`src/components/video/BatchSelectMode.tsx`)
   - åœ¨å½±ç‰‡åˆ—è¡¨ä¸­å•Ÿç”¨å¤šé¸æ¨¡å¼
   - é¸æ“‡å¾Œå¯æ‰¹æ¬¡åŠ å…¥æ’­æ”¾æ¸…å–®

### ç›¸é—œæª”æ¡ˆ
- `package.json` (æ–°å¢ä¾è³´)
- `src/lib/supabase.ts` (ä¿®æ”¹)
- `src/lib/types.ts` (ä¿®æ”¹ï¼Œæ–°å¢ LoopMode é¡å‹)
- `src/app/playlists/[id]/page.tsx` (ä¿®æ”¹)
- `src/app/watch/[id]/page.tsx` (ä¿®æ”¹)
- `src/components/playlist/SortablePlaylistItems.tsx` (æ–°å»º)
- `src/components/playlist/PlaylistEditModal.tsx` (æ–°å»º)
- `src/components/video/BatchSelectMode.tsx` (æ–°å»º)

### å‚™è¨»
- @dnd-kit æ¯” react-beautiful-dnd æ›´è¼•é‡ä¸”ç¶­è­·æ›´ç©æ¥µ
- æ’åºæ›´æ–°æ‡‰ä½¿ç”¨æ¨‚è§€æ›´æ–° (optimistic update)
- è€ƒæ…®åœ¨æ‹–æ›³æ™‚åŠ å…¥è§¸è¦ºåé¥‹ï¼ˆéœ‡å‹•ï¼‰

---

## 7. æœå°‹æ­·å²èˆ‡å»ºè­°

### å•é¡Œæè¿°
æ²’æœ‰æœå°‹æ­·å²è¨˜éŒ„ï¼Œç”¨æˆ¶éœ€è¦é‡è¤‡è¼¸å…¥ç›¸åŒçš„æœå°‹é—œéµå­—ã€‚

### éœ€æ±‚è¦æ ¼

**åŠŸèƒ½ï¼š**
- å„²å­˜æœ€è¿‘ 10-20 ç­†æœå°‹è¨˜éŒ„ï¼ˆæœ¬åœ°å„²å­˜ï¼‰
- æœå°‹æ¡†èšç„¦æ™‚é¡¯ç¤ºæ­·å²è¨˜éŒ„
- å¯æ¸…é™¤å–®ä¸€æˆ–å…¨éƒ¨æ­·å²
- ç†±é–€æœå°‹é—œéµå­—é¡¯ç¤ºï¼ˆå¦‚æœ API æ”¯æ´ï¼‰
- æœå°‹è‡ªå‹•å®Œæˆï¼ˆåŸºæ–¼æ­·å²æˆ–ç†±é–€é—œéµå­—ï¼‰

**UI è¨­è¨ˆï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [æœå°‹æ¡†: |                              ] ğŸ”   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ• æœ€è¿‘æœå°‹                    [æ¸…é™¤å…¨éƒ¨]â”‚    â”‚
â”‚  â”‚    éŠæˆ²å¯¦æ³                         [âœ•] â”‚    â”‚
â”‚  â”‚    ASMR                             [âœ•] â”‚    â”‚
â”‚  â”‚    æ­Œå›                             [âœ•] â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚    â”‚
â”‚  â”‚ ğŸ”¥ ç†±é–€æœå°‹                             â”‚    â”‚
â”‚  â”‚    Minecraft                            â”‚    â”‚
â”‚  â”‚    é›œè«‡                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¦ä½œæ­¥é©Ÿ

1. **å»ºç«‹æœå°‹æ­·å² hook** (`src/hooks/useSearchHistory.ts`)
   ```typescript
   interface UseSearchHistoryReturn {
     history: string[];
     addToHistory: (query: string) => void;
     removeFromHistory: (query: string) => void;
     clearHistory: () => void;
   }

   // ä½¿ç”¨ localStorage å„²å­˜
   export function useSearchHistory(maxItems = 15): UseSearchHistoryReturn
   ```

2. **å»ºç«‹æœå°‹å»ºè­°å…ƒä»¶** (`src/components/search/SearchSuggestions.tsx`)
   - é¡¯ç¤ºæœå°‹æ­·å²
   - é¡¯ç¤ºç†±é–€æœå°‹ï¼ˆå¦‚æœæœ‰ï¼‰
   - éµç›¤å°èˆªæ”¯æ´ (ä¸Šä¸‹éµé¸æ“‡)
   - é»æ“Šæˆ– Enter åŸ·è¡Œæœå°‹

3. **ä¿®æ”¹ Header æœå°‹æ¡†** (`src/components/layout/Header.tsx`)
   - æ•´åˆæœå°‹å»ºè­°ä¸‹æ‹‰é¸å–®
   - èšç„¦æ™‚é¡¯ç¤ºå»ºè­°
   - è¼¸å…¥æ™‚éæ¿¾å»ºè­°

4. **å¯é¸ï¼šç†±é–€æœå°‹ API** (`src/lib/api.ts`)
   - å¦‚æœ Ragtag Archive API æ”¯æ´

### ç›¸é—œæª”æ¡ˆ
- `src/hooks/useSearchHistory.ts` (æ–°å»º)
- `src/components/search/SearchSuggestions.tsx` (æ–°å»º)
- `src/components/layout/Header.tsx` (ä¿®æ”¹)

### å‚™è¨»
- ä½¿ç”¨ localStorage ä¸éœ€è¦ç™»å…¥å³å¯ä½¿ç”¨
- è€ƒæ…®ç‚ºç™»å…¥ç”¨æˆ¶åŒæ­¥æœå°‹æ­·å²åˆ° Supabase
- è‡ªå‹•å®Œæˆæ‡‰æœ‰ debounce é¿å…éå¤šé‹ç®—

---

## 8. ç”¨æˆ¶é ­åƒè‡ªè¨‚

### å•é¡Œæè¿°
`user_profiles` è¡¨å·²æœ‰ `avatar_url` æ¬„ä½ï¼Œä½† UI æ²’æœ‰å¯¦ä½œã€‚

### éœ€æ±‚è¦æ ¼

**åŠŸèƒ½ï¼š**
- åœ¨è¨­å®šé é¢é¡¯ç¤ºç›®å‰é ­åƒ
- æ”¯æ´ä¸Šå‚³è‡ªè¨‚é ­åƒåœ–ç‰‡
- æˆ–è¼¸å…¥é ­åƒ URL
- é ­åƒé è¦½
- é ­åƒè£åˆ‡ï¼ˆå¯é¸ï¼‰

**UI è¨­è¨ˆï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å€‹äººè³‡æ–™è¨­å®š                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                 â”‚
â”‚  é ­åƒ                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚         â”‚  [ä¸Šå‚³åœ–ç‰‡]                        â”‚
â”‚  â”‚  (é è¦½) â”‚  æˆ–                                â”‚
â”‚  â”‚         â”‚  [è¼¸å…¥åœ–ç‰‡ç¶²å€: ____________]      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                 â”‚
â”‚  é¡¯ç¤ºåç¨±                                       â”‚
â”‚  [________________________]                     â”‚
â”‚                                                 â”‚
â”‚  [å„²å­˜è®Šæ›´]                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¦ä½œæ­¥é©Ÿ

1. **è¨­å®š Supabase Storage** (å¦‚æœä½¿ç”¨ä¸Šå‚³)
   - å»ºç«‹ `avatars` bucket
   - è¨­å®šå­˜å–æ”¿ç­–

2. **æ“´å±• Supabase å‡½æ•¸** (`src/lib/supabase.ts`)
   ```typescript
   // ä¸Šå‚³é ­åƒ
   export async function uploadAvatar(
     userId: string,
     file: File
   ): Promise<string>  // è¿”å› URL

   // updateUserProfile å·²å­˜åœ¨ï¼Œç¢ºä¿æ”¯æ´ avatar_url
   ```

3. **å»ºç«‹é ­åƒä¸Šå‚³å…ƒä»¶** (`src/components/settings/AvatarUpload.tsx`)
   - æª”æ¡ˆé¸æ“‡
   - é è¦½
   - ä¸Šå‚³é€²åº¦
   - éŒ¯èª¤è™•ç†

4. **ä¿®æ”¹è¨­å®šé é¢** (`src/app/settings/page.tsx`)
   - æ•´åˆé ­åƒä¸Šå‚³å…ƒä»¶
   - é¡¯ç¤ºç›®å‰é ­åƒ

5. **æ›´æ–° UserMenu é¡¯ç¤º** (`src/components/auth/UserMenu.tsx`)
   - ä½¿ç”¨è‡ªè¨‚é ­åƒï¼ˆå¦‚æœæœ‰ï¼‰

### ç›¸é—œæª”æ¡ˆ
- `src/lib/supabase.ts` (ä¿®æ”¹)
- `src/app/settings/page.tsx` (ä¿®æ”¹)
- `src/components/settings/AvatarUpload.tsx` (æ–°å»º)
- `src/components/auth/UserMenu.tsx` (ä¿®æ”¹)

### å‚™è¨»
- é™åˆ¶ä¸Šå‚³æª”æ¡ˆå¤§å°ï¼ˆå»ºè­° 2MB ä»¥ä¸‹ï¼‰
- é™åˆ¶æª”æ¡ˆé¡å‹ (jpg, png, webp)
- è€ƒæ…®åœ–ç‰‡å£“ç¸®
- å‚™é¸æ–¹æ¡ˆï¼šåªæ”¯æ´ URL è¼¸å…¥ï¼Œä¸å¯¦ä½œä¸Šå‚³

---

## 13. æ•ˆèƒ½å„ªåŒ–

### å•é¡Œæè¿°
ç›®å‰æ²’æœ‰å¯¦ä½œå¿«å–ç­–ç•¥ï¼Œé‡è¤‡è«‹æ±‚ç›¸åŒè³‡æ–™ã€‚

### éœ€æ±‚è¦æ ¼

**å„ªåŒ–é …ç›®ï¼š**
- æœå°‹çµæœå¿«å–
- é »é“è³‡è¨Šå¿«å–
- å½±ç‰‡è©³æƒ…å¿«å–
- åœ–ç‰‡è¼‰å…¥å„ªåŒ–
- ç¨‹å¼ç¢¼åˆ†å‰²

### å¯¦ä½œæ­¥é©Ÿ

1. **å¯¦ä½œ API å¿«å–å±¤** (`src/lib/cache.ts`)
   ```typescript
   interface CacheOptions {
     ttl: number;  // Time to live in ms
     maxSize?: number;
   }

   class ApiCache {
     private cache: Map<string, { data: any; timestamp: number }>;

     get<T>(key: string): T | null;
     set<T>(key: string, data: T): void;
     invalidate(pattern?: string): void;
   }

   export const apiCache = new ApiCache({ ttl: 5 * 60 * 1000 }); // 5 åˆ†é˜
   ```

2. **ä¿®æ”¹ API å‡½æ•¸ä½¿ç”¨å¿«å–** (`src/lib/api.ts`)
   ```typescript
   export async function getVideoById(videoId: string) {
     const cacheKey = `video:${videoId}`;
     const cached = apiCache.get(cacheKey);
     if (cached) return cached;

     const data = await fetchVideo(videoId);
     apiCache.set(cacheKey, data);
     return data;
   }
   ```

3. **å¯¦ä½œ SWR æˆ– React Query** (å¯é¸)
   - æ›´æˆç†Ÿçš„è³‡æ–™ç²å–èˆ‡å¿«å–æ–¹æ¡ˆ
   - è‡ªå‹•é‡æ–°é©—è­‰
   - è«‹æ±‚å»é‡

4. **åœ–ç‰‡å„ªåŒ–**
   - ä½¿ç”¨ Next.js Image å…ƒä»¶
   - å¯¦ä½œ blur placeholder
   - æ‡¶è¼‰å…¥å„ªåŒ–

5. **ç¨‹å¼ç¢¼åˆ†å‰²**
   - å‹•æ…‹è¼‰å…¥å¤§å‹å…ƒä»¶
   - è·¯ç”±å±¤ç´šåˆ†å‰²

### ç›¸é—œæª”æ¡ˆ
- `src/lib/cache.ts` (æ–°å»º)
- `src/lib/api.ts` (ä¿®æ”¹)
- `src/components/video/VideoCard.tsx` (ä¿®æ”¹ï¼Œåœ–ç‰‡å„ªåŒ–)
- å„é é¢ (å‹•æ…‹è¼‰å…¥)

### å‚™è¨»
- è€ƒæ…®ä½¿ç”¨ `swr` æˆ– `@tanstack/react-query`
- å¿«å–å¤±æ•ˆç­–ç•¥å¾ˆé‡è¦
- ç›£æ§å¿«å–å‘½ä¸­ç‡

---

## 14. ä¸‹è¼‰åŠŸèƒ½

### å•é¡Œæè¿°
ç”¨æˆ¶ç„¡æ³•ç›´æ¥ä¸‹è¼‰å½±ç‰‡æˆ–ç›¸é—œæª”æ¡ˆã€‚

### éœ€æ±‚è¦æ ¼

**åŠŸèƒ½ï¼š**
- ä¸‹è¼‰å½±ç‰‡æª”æ¡ˆï¼ˆé¸æ“‡æ ¼å¼ï¼‰
- ä¸‹è¼‰ç¸®åœ–
- ä¸‹è¼‰èŠå¤©è¨˜éŒ„ (JSON/TXT)
- ä¸‹è¼‰å½±ç‰‡è³‡è¨Š (JSON)

**UI è¨­è¨ˆï¼ˆåœ¨è§€çœ‹é é¢ï¼‰ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æª”æ¡ˆä¸‹è¼‰                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                 â”‚
â”‚  å½±ç‰‡æª”æ¡ˆ                                       â”‚
â”‚  â”œâ”€ video.mp4 (1.2 GB)           [â¬‡ ä¸‹è¼‰]      â”‚
â”‚  â”œâ”€ video.webm (980 MB)          [â¬‡ ä¸‹è¼‰]      â”‚
â”‚  â””â”€ video.mkv (1.5 GB)           [â¬‡ ä¸‹è¼‰]      â”‚
â”‚                                                 â”‚
â”‚  å…¶ä»–æª”æ¡ˆ                                       â”‚
â”‚  â”œâ”€ ç¸®åœ– thumbnail.webp          [â¬‡ ä¸‹è¼‰]      â”‚
â”‚  â”œâ”€ èŠå¤©è¨˜éŒ„ chat.json           [â¬‡ ä¸‹è¼‰]      â”‚
â”‚  â””â”€ å½±ç‰‡è³‡è¨Š info.json           [â¬‡ ä¸‹è¼‰]      â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¦ä½œæ­¥é©Ÿ

1. **å»ºç«‹ä¸‹è¼‰å·¥å…·å‡½æ•¸** (`src/lib/download.ts`)
   ```typescript
   // è§¸ç™¼ç€è¦½å™¨ä¸‹è¼‰
   export function downloadFile(url: string, filename: string): void {
     const a = document.createElement('a');
     a.href = url;
     a.download = filename;
     a.click();
   }

   // ä¸‹è¼‰ JSON è³‡æ–™
   export function downloadJson(data: object, filename: string): void

   // ä¸‹è¼‰èŠå¤©è¨˜éŒ„ç‚º TXT
   export function downloadChatAsText(
     chatData: ChatMessage[],
     filename: string
   ): void
   ```

2. **å»ºç«‹ä¸‹è¼‰å€å¡Šå…ƒä»¶** (`src/components/video/DownloadSection.tsx`)
   - åˆ—å‡ºæ‰€æœ‰å¯ä¸‹è¼‰æª”æ¡ˆ
   - é¡¯ç¤ºæª”æ¡ˆå¤§å°
   - ä¸‹è¼‰æŒ‰éˆ•
   - ä¸‹è¼‰é€²åº¦ï¼ˆå¦‚æœå¯è¡Œï¼‰

3. **ä¿®æ”¹è§€çœ‹é é¢** (`src/app/watch/[id]/page.tsx`)
   - æ•´åˆä¸‹è¼‰å€å¡Š
   - å¯æ‘ºç–Šé¡¯ç¤º

### ç›¸é—œæª”æ¡ˆ
- `src/lib/download.ts` (æ–°å»º)
- `src/components/video/DownloadSection.tsx` (æ–°å»º)
- `src/app/watch/[id]/page.tsx` (ä¿®æ”¹)

### å‚™è¨»
- å¤§æª”æ¡ˆä¸‹è¼‰å¯èƒ½éœ€è¦ç‰¹æ®Šè™•ç†
- è€ƒæ…® CORS é™åˆ¶
- å¯èƒ½éœ€è¦ä½¿ç”¨ streaming download
- èŠå¤©è¨˜éŒ„è½‰ TXT æ ¼å¼ï¼š`[æ™‚é–“] ç”¨æˆ¶å: è¨Šæ¯`

---

## é–‹ç™¼é †åºå»ºè­°

æ ¹æ“šç›¸ä¾æ€§å’Œè¤‡é›œåº¦ï¼Œå»ºè­°ä»¥ä¸‹é–‹ç™¼é †åºï¼š

### ç¬¬ä¸€éšæ®µï¼ˆåŸºç¤æ”¹é€²ï¼‰
1. âœ… **404 é é¢** - æœ€ç°¡å–®ï¼Œç¨ç«‹åŠŸèƒ½
2. âœ… **ç”¨æˆ¶é ­åƒè‡ªè¨‚** - ç¨ç«‹åŠŸèƒ½ï¼Œè¤‡é›œåº¦ä½

### ç¬¬äºŒéšæ®µï¼ˆæœå°‹å¢å¼·ï¼‰
3. âœ… **æœå°‹æ­·å²èˆ‡å»ºè­°** - æ”¹å–„æœå°‹é«”é©—
4. âœ… **é€²éšæœå°‹ç¯©é¸** - ä¾è³´æœå°‹ç³»çµ±

### ç¬¬ä¸‰éšæ®µï¼ˆåŠŸèƒ½å®Œå–„ï¼‰
5. âœ… **é »é“åˆ—è¡¨é é¢** - ä¿®å¾©å°èˆªå•é¡Œ
6. âœ… **æ’­æ”¾æ¸…å–®æ’åºèˆ‡å¢å¼·** - è¼ƒè¤‡é›œï¼Œéœ€è¦æ–°ä¾è³´

### ç¬¬å››éšæ®µï¼ˆå„ªåŒ–èˆ‡æ“´å±•ï¼‰
7. âœ… **æ•ˆèƒ½å„ªåŒ–** - å…¨åŸŸå½±éŸ¿ï¼Œå»ºè­°è¼ƒå¾Œå¯¦ä½œ
8. âœ… **ä¸‹è¼‰åŠŸèƒ½** - ç¨ç«‹åŠŸèƒ½

---

## è®Šæ›´è¨˜éŒ„

| æ—¥æœŸ | è®Šæ›´å…§å®¹ |
|------|----------|
| 2024-XX-XX | åˆå§‹ç‰ˆæœ¬ï¼Œè¦åŠƒ 8 é …åŠŸèƒ½ |

